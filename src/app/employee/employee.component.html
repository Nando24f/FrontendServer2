<div class="container">
  <div class="sidebar">
    <h3>Selección de Calle</h3>
    <select [(ngModel)]="selectedCalle" class="manager-select">
      <option *ngFor="let calle of calles" [value]="calle">
        {{ calle }}
      </option>
    </select>
    <button (click)="onSearch()" class="search-button" [disabled]="!selectedCalle">
      Consultar Datos
    </button>
  </div>

  <div class="main-content">
    <div *ngIf="loading" class="loading">Cargando datos...</div>

    <div *ngIf="vecinos.length > 0" class="results">
      <h2>Resumen de Residentes en {{selectedCalle}}</h2>
      <div class="results-info">
        <p>Total de residentes: <strong>{{vecinos.length}}</strong></p>
        <p>Porcentaje de hombres con alarmas activas: <strong>{{porcentajeHombres}}%</strong></p>
      </div>

      <h3>Distribución por Género</h3>
      <div class="compact-chart-container">
        <p-chart type="doughnut" [data]="chartData" [options]="chartOptions"
          [style]="{ height: '240px', width: '100%' }">
        </p-chart>
      </div>

      <h3>Registro de Residentes</h3>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Dirección</th>
            <th>RUT</th>
            <th>Sexo</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let vecino of vecinos">
            <td>{{ vecino.id }}</td>
            <td>{{ vecino.nombre }}</td>
            <td>{{ vecino.apellido }}</td>
            <td>{{ vecino.direccion }} {{ vecino.numero_casa }}</td>
            <td>{{ vecino.rut }}</td>
            <td>{{ vecino.sexo }}</td>
          </tr>
        </tbody>
      </table>

      <h3>Historial de Alarmas Recientes</h3>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Dirección</th>
            <th>Fecha</th>
            <th>Hora</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let alarma of alarmas">
            <td>{{ alarma.id }}</td>
            <td>{{ alarma.nombre }}</td>
            <td>{{ alarma.apellido }}</td>
            <td>{{ alarma.direccion_usuario }}</td>
            <td>{{ alarma.fecha | date }}</td>
            <td>{{ alarma.hora }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="vecinos.length === 0 && !loading" class="no-results">
      Selecciona una calle y haz clic en "Consultar Datos" para ver la información
    </div>
  </div>
</div>